# 액션에서 계산 빼내기

## 장바구니 앱의 테스트 코드 작성.


1. 테스트 하기 쉽게 만들어야 함.
2. 재사용 하기 쉽게 만들어야 함.


> 'DOM을 실행 할 수 있는 곳에서 실행된다고 가정하면 안된다.' 

## 순수함수는 명시적이여야 한다.

### 암묵(시)적 & 명시적

명시적 - 문서, 메뉴얼 같은 공유된 지식 (자격증, 공식 문서, 법) -> 공식적으로 변경 되기 전까지는 안바뀜   
암묵적 - 학습, 경험에 의한 지식 (노하우, 암묵적인  룰) -> 언제 어떻게 바뀔지 모름.


책에서의 예시 > 전역 변수를 함수 내부에서 참조 (암묵적이다.), 외부 메서드를 사용 (암묵적이다.)

### 테스트와 함수의 입출력

책에서 조지의 제안

1. 돔 업데이트 와 비지니스로직의 분리
2. 전역 변수 없애기

책에서 제나의 제안

1. 전역변수 의존성 줄이기
2. 함수의 출력을 돔 업데이트를 하는 암시적은 출력이 아닌, 명시적 출력으로 수정 
3. 함수가 결과값을 출력하도록 하자.

내가 생각한 제안
1. 코드에서 언제 어디에서 재사용 되더라도 문제 없는 코드를 함수로 분리 (순수함수)
2. 돔 업데이트를 위한 규칙을 만들어서 입력과 출력으로만 돔 업데이트 하기 (외부 변수 참조 X)


## 리액트등을 활용한 컴포넌트 개발에서의 예시

>  돔을 업데이트 하는 액션은 격리 되어 있음(돔 업데이트 로직 통일화) - 개발장 입장에서 명시적임

우리는 대부분 리덕스등의 전역 상태 관리를 쓰거나, 컴포넌트 내부에서 돔의 이벤트에 리스너를 등록하는 등 (사실, 가짜 리스너를 달긴함.)  
어쩔 수 없는 액션을 컴포넌트 내부에서 사용하게 됨.  

그래서 되도록 이런 전역 상태를 참조 액션을 핸등링 하는 것을 최소화 하고,  
공용 컴포넌트를 추상화 해서 사용하는데, 해답은 아니지만 몇개를 대입해서 설명

### 1번 컨테이너 / 프리젠테이션 

컨테이너 (전역 상태, 서버에서 받은 데이터 처리등) / 프리젠테이션 프리젠테이션 컴포넌트 (Props으로 내려온 값을 화면에 노출)

내가 생각한 문제.   
컨테이너 역할이 너무 커지고, 프리젠테이션에서 이벤트 리스너 등록을 하게 됨 (액션이 됨.), 요청 트리거를 프리젠테이션에서 하게 되는데, 요청을 역전 시켜야함.

### 2번 아토믹 디자인

작은 단위에서 조합하여 재사용할수 있는 형태로 만들어서 사용 (atoms > molecules > organisms > templates > pages  )

내가 생각한 문제. 재사용을 하기 위해서 만들어 졌으나, 비지니스 로직 변경 요구사항 변경에 따라, 변경 비용이 많이 발생한다. 우리가 어떻게 서비스가 커갈지만   
안다면 좋은 방법이지만, 재 설계 비용이 만만치 않음.

### 3번.전역 상태 관리 패턴

전역 상태로만 앱의 상태를 관리하는 패턴, 이렇게 되면 지역상태 분일치등을 해소할수 있다. >> 앵귤러. 리덕스등

내가 생각한 문제.
돔에 데이터 바인딩을 핸들링 하는 권한이 앱에 넘어가 버리기 때문에 성능 컨트롤이 힘들어지고, 개발의 다양성이 적어짐. 앱 전체가 앱의 상태에 의존적이라,  
앱의 상태를 관찰하는 툴등이 없으면 개발하기 너무 힘들다.

### 4번. 리덕스등을 활용한 불변성 확보

상태가 바뀌면 랜더링 되는 구조로 설계되어 있는 리액트에서 불변성은 중요함.  
그래서 복사한 값을 새로 할당하거나, useRecuder, redux, immer 등을 활용한다.

내가 생각한 문제.
여러 컴포넌트에서 상태가 바뀌는 것에 의해 랜더링 되기 때문에 내가 온전히 컴포넌트 랜더링을 제어하기 쉽지 않음. 

---
### 내가 생각한 방법

전역상태 참조 문제      
일단, 전역 상태를 쓰는것은 어쩔수 없는 선택 일수 있다. 현실적으로... 하지만, 전역상태를 최소화 시킬수 있으면, 컴포넌트가 의존성을 갖지 않는다.    
그러려면 화면을 설계할때 같은 상태를 공유하는 뷰끼리 커플링된 데이터를 표기하고, 데이터를 공유할 수 있는 방법을 마련한다.   
(로컬 캐싱, 지역 컨텍스트 상태(recoil, context api 등), )
설계단에서 시각적으로 표현해주는게 베스트 그리고 가장 좋은것은 immer등을 활용해서 상태 업데이트시 불변성을 확보.

컴포넌트 재사용  
일단 요즘 가장많은 개발자들이 잘 쓰는 hook을 통해서 요청을 분리한다던가, 이벤트 리스너 등록을 분리한다던가 해서 액션을 hook으로 분리함.  
또한 hook을 통해 UI 상태를 분리해서 상태 제어 순수함수로 재활용 할수 있다.  그래서 hook은 컴포넌트를 함수형으로 분리해 주는 좋은 기능.  
하지만 위의 조합 레벨의 구조화 문제는 개인적으로는 style과 컴포넌트 기능을 나눠서 써야지 나중에 재설계 하거나, 조합한 컴포넌트에 영향을 많이 끼칠 일이 없을 것 같음.
그래서 공통으로 정의된 UI 컴포넌트(스타일)와, 인풋, 셀렉트, 버튼등 추상화된 기능 요소 컴포넌트를 두개의 순수함수로 생각해서 재상용하려고 함.


### 이번 챕터 개인적 정리

결국 액션 함수 순수 함수 분리는 외부 의존성을 없애서 순수함수로 분리하는것.   
작업 일정에 쫒겨서 타협하는 부분이 많은데, 이건 비지니스 적인 외부 상황을 잘 이해하면서  
타협 가능한 선과 아닌선을 나눌 수 있는게 개발자의 역량인것 같음.
